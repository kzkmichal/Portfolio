(function(a,b,c){'use strict';"undefined"!=typeof window&&"function"==typeof define&&define.amd?define(c):"undefined"!=typeof module&&module.exports?module.exports=c():b.exports?b.exports=c():b[a]=c()})("ccWebRecorder",this,function(){"use strict";function j(a){try{var b=a.rules||a.cssRules;return b?Array.from(b).reduce(function(a,b){return a+(function(a){return"styleSheet"in a}(c=b)?j(c.styleSheet)||"":c.cssText);var c},""):null}catch(a){return null}}function q(b,g){return b.replace(Q,function(b,e,h,i){var j,k=e||h||i;if(!k)return b;if(!R.test(k))return"url('"+k+"')";if(a.test(k))return"url("+k+")";if("/"===k[0])return"url('"+((-1<(j=g).indexOf("//")?j.split("/").slice(0,3).join("/"):j.split("/")[0]).split("?")[0]+k)+"')";var c=g.split("/"),m=k.split("/");c.pop();for(var l,n=0,o=m;n<o.length;n++)l=o[n],"."!==l&&(".."===l?c.pop():c.push(l));return"url('"+c.join("/")+"')"})}function r(a,b){if(""===b.trim())return b;var c=a.createElement("a");return c.href=b,c.href}function z(a,b,c){return"src"===b||"href"===b?r(a,c):"srcset"===b?function(a,b){return""===b.trim()?b:b.split(",").map(function(b){var c=b.trimLeft().trimRight().split(" ");return 2===c.length?r(a,c[0])+" "+c[1]:1===c.length?""+r(a,c[0]):""}).join(",")}(a,c):"style"===b?q(c,location.href):c}function s(e,k,l,a,i,n,o){void 0===i&&(i=!1),void 0===n&&(n=!0),void 0===o&&(o=!1);var r,t=function(k,e,n,o,a){switch(k.nodeType){case k.DOCUMENT_NODE:return{type:J.Document,childNodes:[]};case k.DOCUMENT_TYPE_NODE:return{type:J.DocumentType,name:k.name,publicId:k.publicId,systemId:k.systemId};case k.ELEMENT_NODE:var i=!1;"string"==typeof n?i=k.classList.contains(n):k.classList.forEach(function(a){n.test(a)&&(i=!0)});for(var r=k.tagName.toLowerCase(),l={},d=0,s=Array.from(k.attributes);d<s.length;d++){var f=s[d],m=f.name,h=f.value;l[m]=z(e,m,h)}if("link"===r&&o){var t,u=Array.from(e.styleSheets).find(function(a){return a.href===k.href});(t=j(u))&&(delete l.rel,delete l.href,l._cssText=q(t,u.href))}if("style"===r&&k.sheet&&!(k.innerText||k.textContent||"").trim().length&&(t=j(k.sheet))&&(l._cssText=q(t,location.href)),"input"!==r&&"textarea"!==r&&"select"!==r||(h=k.value,"radio"!==l.type&&"checkbox"!==l.type&&h?l.value=a?"*".repeat(h.length):h:k.checked&&(l.checked=k.checked)),"option"===r){var g=k.parentElement;l.value===g.value&&(l.selected=k.selected)}if("canvas"===r&&(l.rr_dataURL=k.toDataURL()),i){var b=k.getBoundingClientRect(),x=b.width,A=b.height;l.rr_width=x+"px",l.rr_height=A+"px"}return{type:J.Element,tagName:r,attributes:l,childNodes:[],isSVG:(D=k,"svg"===D.tagName||D instanceof SVGElement||void 0),needBlock:i};case k.TEXT_NODE:var w=k.parentNode&&k.parentNode.tagName,B=k.textContent,C="STYLE"===w||void 0;return C&&B&&(B=q(B,location.href)),"SCRIPT"===w&&(B="SCRIPT_PLACEHOLDER"),{type:J.Text,textContent:B||"",isStyle:C};case k.CDATA_SECTION_NODE:return{type:J.CDATA,textContent:""};case k.COMMENT_NODE:return{type:J.Comment,textContent:k.textContent||""};default:return!1;}var D}(e,k,a,n,o);if(!t)return console.warn(e,"not serialized"),null;r="__sn"in e?e.__sn.id:P++;var m=Object.assign(t,{id:r});e.__sn=m,l[r]=e;var h=!i;if(m.type===J.Element&&(h=h&&!m.needBlock,delete m.needBlock),(m.type===J.Document||m.type===J.Element)&&h)for(var u,w=0,x=Array.from(e.childNodes);w<x.length;w++)u=s(x[w],k,l,a,i,n,o),u&&m.childNodes.push(u);return m}function B(a,b,c){void 0===c&&(c=document);var d={capture:!0,passive:!0};return c.addEventListener(a,b,d),function(){return c.removeEventListener(a,b,d)}}function d(a,b,d){void 0===d&&(d={});var e=null,f=0;return function(){var g=Date.now();f||!1!==d.leading||(f=g);var h=b-(g-f),i=this,c=arguments;0>=h||h>b?(e&&(window.clearTimeout(e),e=null),f=g,a.apply(i,c)):e||!1===d.trailing||(e=window.setTimeout(function(){f=!1===d.leading?0:Date.now(),e=null,a.apply(i,c)},h))}}function c(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function g(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function F(a,b){if(!a)return!1;if(a.nodeType===a.ELEMENT_NODE){var c=!1;return"string"==typeof b?c=a.classList.contains(b):a.classList.forEach(function(a){b.test(a)&&(c=!0)}),c||F(a.parentNode,b)}return F(a.parentNode,b)}function b(a){return!!a.changedTouches}function l(a,b){a.delete(b),b.childNodes.forEach(function(b){return l(a,b)})}function w(a,b){var c=b.parentNode;return!!c&&(!!a.has(c)||w(a,c))}function u(a){return"__sn"in a}function y(j,k,a,b){var c=new MutationObserver(function(e){var q=[],t=[],v=[],n=[],c=new Set,d=new Set,p=new Set,f={},m=function(a,b){if(!F(a,k)){if(u(a)){d.add(a);var e=null;b&&u(b)&&(e=b.__sn.id),e&&(f[i(a.__sn.id,e)]=!0)}else c.add(a),p.delete(a);a.childNodes.forEach(function(a){return m(a)})}};e.forEach(function(a){var e=a.type,h=a.target,j=a.oldValue,n=a.addedNodes,o=a.removedNodes,r=a.attributeName;switch(e){case"characterData":var s=h.textContent;F(h,k)||s===j||q.push({value:s,node:h});break;case"attributes":if(s=h.getAttribute(r),F(h,k)||s===j)return;var u=t.find(function(a){return a.node===h});u||(u={node:h,attributes:{}},t.push(u)),u.attributes[r]=z(document,r,s);break;case"childList":n.forEach(function(a){return m(a,h)}),o.forEach(function(a){var b=S.getId(a),e=S.getId(h);F(a,k)||(c.has(a)?(l(c,a),p.add(a)):c.has(h)&&-1===b||function a(b){var c=S.getId(b);return!S.has(c)||(!b.parentNode||b.parentNode.nodeType!==b.DOCUMENT_NODE)&&(!b.parentNode||a(b.parentNode))}(h)||(d.has(a)&&f[i(b,e)]?l(d,a):v.push({parentId:e,id:b})),S.removeNodeFromMap(a))});}});var h=[],o=function(c){var d=S.getId(c.parentNode);return-1===d?h.push(c):void n.push({parentId:d,previousId:c.previousSibling?S.getId(c.previousSibling):c.previousSibling,nextId:c.nextSibling?S.getId(c.nextSibling):c.nextSibling,node:s(c,document,S.map,k,!0,a,b)})};for(Array.from(d).forEach(o),Array.from(c).forEach(function(a){w(p,a)||function a(b,c){var d=c.parentNode;if(!d)return!1;var f=S.getId(d);return!!b.some(function(a){return a.id===f})||a(b,d)}(v,a)?w(d,a)?o(a):p.add(a):o(a)});h.length&&!h.every(function(a){return-1===S.getId(a.parentNode)});)o(h.shift());var g={texts:q.map(function(a){return{id:S.getId(a.node),value:a.value}}).filter(function(a){return S.has(a.id)}),attributes:t.map(function(a){return{id:S.getId(a.node),attributes:a.attributes}}).filter(function(a){return S.has(a.id)}),removes:v,adds:n};(g.texts.length||g.attributes.length||g.removes.length||g.adds.length)&&j(g)});return c.observe(document,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),c}function C(c,d){var e=[];return Object.keys(N).filter(function(a){return Number.isNaN(+a)&&!a.endsWith("_Departed")}).forEach(function(f){var g=f.toLowerCase(),h=function(e){return function(f){if(!F(f.target,d)){var g=S.getId(f.target),h=b(f)?f.changedTouches[0]:f,a=h.clientX,i=h.clientY;c({type:N[e],id:g,x:a,y:i})}}}(f);e.push(B(g,h))}),function(){e.forEach(function(a){return a()})}}function D(b,d,e,f){function g(b){var g=b.target;if(g&&g.tagName&&!(0>T.indexOf(g.tagName))&&!F(g,d)){var i=g.type;if("password"!==i&&!g.classList.contains(e)){var a=g.value,j=!1,m=k.includes(i)||"TEXTAREA"===g.tagName;"radio"===i||"checkbox"===i?j=g.checked:m&&f&&(a="*".repeat(a.length)),h(g,{text:a,isChecked:j});var n=g.name;"radio"===i&&n&&j&&document.querySelectorAll("input[type=\"radio\"][name=\""+n+"\"]").forEach(function(a){a!==g&&h(a,{text:a.value,isChecked:!j})})}}}function h(c,d){var e=L.get(c);if(!e||e.text!==d.text||e.isChecked!==d.isChecked){L.set(c,d);var f=S.getId(c);b(E(E({},d),{id:f}))}}var a=["input","change"].map(function(a){return B(a,g)}),i=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value"),c=[[HTMLInputElement.prototype,"value"],[HTMLInputElement.prototype,"checked"],[HTMLSelectElement.prototype,"value"],[HTMLTextAreaElement.prototype,"value"]];return i&&i.set&&a.push.apply(a,c.map(function(a){return function b(c,d,f,e){var g=Object.getOwnPropertyDescriptor(c,d);return Object.defineProperty(c,d,e?f:{set:function(a){var b=this;setTimeout(function(){f.set.call(b,a)},0),g&&g.set&&g.set.call(this,a)}}),function(){return b(c,d,g||{},!0)}}(a[0],a[1],{set:function(){g({target:this})}})})),function(){a.forEach(function(a){return a()})}}function G(f,e){void 0===e&&(e={}),function(b,c){var d=b.mutationCb,f=b.mousemoveCb,g=b.mouseInteractionCb,h=b.scrollCb,a=b.viewportResizeCb,i=b.inputCb;b.mutationCb=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c.mutation&&c.mutation.apply(c,a),d.apply(void 0,a)},b.mousemoveCb=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c.mousemove&&c.mousemove.apply(c,a),f.apply(void 0,a)},b.mouseInteractionCb=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c.mouseInteraction&&c.mouseInteraction.apply(c,a),g.apply(void 0,a)},b.scrollCb=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c.scroll&&c.scroll.apply(c,a),h.apply(void 0,a)},b.viewportResizeCb=function(){for(var b=[],d=0;d<arguments.length;d++)b[d]=arguments[d];c.viewportResize&&c.viewportResize.apply(c,b),a.apply(void 0,b)},b.inputCb=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c.input&&c.input.apply(c,a),i.apply(void 0,a)}}(f,e);var j,k,q,v,w,x,z=y(f.mutationCb,f.blockClass,f.inlineStylesheet,f.maskAllInputs),A=(j=f.mousemoveCb,q=[],v=d(function(a){var b=Date.now()-k;j(q.map(function(a){return a.timeOffset-=b,a}),a?I.TouchMove:I.MouseMove),q=[],k=null},500),w=d(function(a){var c=a.target,d=b(a)?a.changedTouches[0]:a,e=d.clientX,f=d.clientY;k||(k=Date.now()),q.push({x:e,y:f,id:S.getId(c),timeOffset:Date.now()-k}),v(b(a))},50,{trailing:!1}),x=[B("mousemove",w),B("touchmove",w)],function(){x.forEach(function(a){return a()})}),s=C(f.mouseInteractionCb,f.blockClass),l=function(a,b){return B("scroll",d(function(c){if(c.target&&!F(c.target,b)){var d=S.getId(c.target);if(c.target===document){var e=document.scrollingElement||document.documentElement;a({id:d,x:e.scrollLeft,y:e.scrollTop})}else a({id:d,x:c.target.scrollLeft,y:c.target.scrollTop})}},100))}(f.scrollCb,f.blockClass),p=function(a){return B("resize",d(function(){var b=c(),d=g();a({width:+d,height:+b})},200),window)}(f.viewportResizeCb),m=D(f.inputCb,f.blockClass,f.ignoreClass,f.maskAllInputs);return function(){z.disconnect(),A(),s(),l(),p(),m()}}function H(a){return E(E({},a),{timestamp:Date.now()})}function A(b){function d(a){void 0===a&&(a=!1),v(H({type:K.Meta,data:{href:window.location.href,width:g(),height:c()}}),a);var b=function(a,b,c,d){void 0===b&&(b="rr-block"),void 0===c&&(c=!0),void 0===d&&(d=!1);var e={};return[s(a,a,e,b,!1,c,d),e]}(document,i,m,u),d=b[0],f=b[1];return d?void(S.map=f,v(H({type:K.FullSnapshot,data:{node:d,initialOffset:{left:document.documentElement.scrollLeft,top:document.documentElement.scrollTop}}}))):console.warn("Failed to snapshot the document")}void 0===b&&(b={});var f,j=b.emit,k=b.checkoutEveryNms,l=b.checkoutEveryNth,a=b.blockClass,i=void 0===a?"rr-block":a,o=b.ignoreClass,p=void 0===o?"rr-ignore":o,q=b.inlineStylesheet,m=void 0===q||q,h=b.maskAllInputs,u=void 0!==h&&h,r=b.hooks;if(!j)throw new Error("emit function is required");"NodeList"in window&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);var x=0;v=function(a,b){if(j(a,b),a.type===K.FullSnapshot)f=a,x=0;else if(a.type===K.IncrementalSnapshot){x++;var c=l&&x>=l,e=k&&a.timestamp-f.timestamp>k;(c||e)&&d(!0)}};try{var t=[B("DOMContentLoaded",function(){v(H({type:K.DomContentLoaded,data:{}}))})],y=function(){d(),t.push(G({mutationCb:function(a){return v(H({type:K.IncrementalSnapshot,data:E({source:I.Mutation},a)}))},mousemoveCb:function(a,b){return v(H({type:K.IncrementalSnapshot,data:{source:b,positions:a}}))},mouseInteractionCb:function(a){return v(H({type:K.IncrementalSnapshot,data:E({source:I.MouseInteraction},a)}))},scrollCb:function(a){return v(H({type:K.IncrementalSnapshot,data:E({source:I.Scroll},a)}))},viewportResizeCb:function(a){return v(H({type:K.IncrementalSnapshot,data:E({source:I.ViewportResize},a)}))},inputCb:function(a){return v(H({type:K.IncrementalSnapshot,data:E({source:I.Input},a)}))},blockClass:i,ignoreClass:p,maskAllInputs:u,inlineStylesheet:m},r))};return"interactive"===document.readyState||"complete"===document.readyState?y():t.push(B("load",function(){v(H({type:K.Load,data:{}})),y()},window)),function(){t.forEach(function(a){return a()})}}catch(a){console.warn(a)}}var J,E=function(){return(E=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};!function(a){a[a.Document=0]="Document",a[a.DocumentType=1]="DocumentType",a[a.Element=2]="Element",a[a.Text=3]="Text",a[a.CDATA=4]="CDATA",a[a.Comment=5]="Comment"}(J||(J={}));var K,I,N,O,P=1,Q=/url\((?:'([^']*)'|"([^"]*)"|([^)]*))\)/gm,R=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/).*/,a=/^(data:)([\w\/\+\-]+);(charset=[\w-]+|base64).*,(.*)/i,S={map:{},getId:function(a){return a.__sn?a.__sn.id:-1},getNode:function(a){return S.map[a]||null},removeNodeFromMap:function(a){var b=a.__sn&&a.__sn.id;delete S.map[b],a.childNodes&&a.childNodes.forEach(function(a){return S.removeNodeFromMap(a)})},has:function(a){return S.map.hasOwnProperty(a)}};!function(a){a[a.DomContentLoaded=0]="DomContentLoaded",a[a.Load=1]="Load",a[a.FullSnapshot=2]="FullSnapshot",a[a.IncrementalSnapshot=3]="IncrementalSnapshot",a[a.Meta=4]="Meta",a[a.Custom=5]="Custom"}(K||(K={})),function(a){a[a.Mutation=0]="Mutation",a[a.MouseMove=1]="MouseMove",a[a.MouseInteraction=2]="MouseInteraction",a[a.Scroll=3]="Scroll",a[a.ViewportResize=4]="ViewportResize",a[a.Input=5]="Input",a[a.TouchMove=6]="TouchMove"}(I||(I={})),function(a){a[a.MouseUp=0]="MouseUp",a[a.MouseDown=1]="MouseDown",a[a.Click=2]="Click",a[a.ContextMenu=3]="ContextMenu",a[a.DblClick=4]="DblClick",a[a.Focus=5]="Focus",a[a.Blur=6]="Blur",a[a.TouchStart=7]="TouchStart",a[a.TouchMove_Departed=8]="TouchMove_Departed",a[a.TouchEnd=9]="TouchEnd"}(N||(N={})),function(a){a.Start="start",a.Pause="pause",a.Resume="resume",a.Resize="resize",a.Finish="finish",a.FullsnapshotRebuilded="fullsnapshot-rebuilded",a.LoadStylesheetStart="load-stylesheet-start",a.LoadStylesheetEnd="load-stylesheet-end",a.SkipStart="skip-start",a.SkipEnd="skip-end",a.MouseInteraction="mouse-interaction"}(O||(O={}));var v,i=function(a,b){return a+"@"+b},T=["INPUT","TEXTAREA","SELECT"],k=["color","date","datetime-local","email","month","number","range","search","tel","text","time","url","week"],L=new WeakMap;return A.addCustomEvent=function(a,b){if(!v)throw new Error("please add custom event after start recording");v(H({type:K.Custom,data:{tag:a,payload:b}}))},A});